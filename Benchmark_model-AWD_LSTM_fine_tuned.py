# -*- coding: utf-8 -*-
"""Untitled17.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1dwN3ILpZDVPfLGDQMd-hdIMwg6g5QVUR
"""

!pip install fastai

from fastai.text.all import *

from google.colab import drive
import os

#drive.mount('/content/drive')
path = '/content/drive/MyDrive/Kaggle_int_hc'
os.listdir(path)

(path/'test').ls()

(path/'test/neg').ls()

"""Folder is organized in Imagenet style"""

#dls = TextDataLoaders.from_folder(untar_data(URLs.IMDB), valid='test') # It is similar to PyTorch dataloader, but it is better suited for NLP tasks. (Indicates sentence start and letter capitalization) with special keywords.
# Uses random sampling
# Todo - check how can I change the sampling method here


# Define the data block
dblock = DataBlock(blocks=(TextBlock.from_folder(path=path), CategoryBlock),
                   get_items=partial(get_text_files, folders=['train', 'test']),
                   get_y=parent_label,
                   splitter=GrandparentSplitter(valid_name='test'))

# Create the DataLoaders
dls = dblock.dataloaders(source=path, bs=64)

dls = dblock.dataloaders(source=path, bs=64)

dls.show_batch()

learn = text_classifier_learner(dls, AWD_LSTM, drop_mult=0.5, metrics=accuracy)

learn.fine_tune(2, 1e-2)